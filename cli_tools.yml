---
- name: Get terraform version
  shell: curl https://github.com/hashicorp/terraform/releases/latest   | grep -Po 'tag/v\K[^"]+' 
  register: terraform_version
- name: Download terraform binary
  get_url:
    url: https://releases.hashicorp.com/terraform/{{ terraform_version.stdout }}/terraform_{{ terraform_version.stdout }}_linux_amd64.zip
    dest: /tmp/tf.zip
    mode: 0777
- name: unzip terraform binary
  unarchive: 
    src: /tmp/tf.zip
    dest: /usr/local/bin/
  become: yes
- name: set perms on terraform
  command: chmod 777 /usr/local/bin/terraform
  become: yes
- name: Get oc version
  shell: curl https://github.com/openshift/origin/releases/latest   | grep -Po 'tag/v\K[^"]+' 
  register: oc_version
- name: Get oc download URL
  shell: curl https://github.com/openshift/origin/releases/tag/v"{{ oc_version.stdout }}" | grep "{{ oc_version.stdout }}" | grep linux-64bit.tar.gz | grep href | grep openshift-origin-client-tools | awk -F "\"" '{print $2}'
  register: oc_download_url
- name: Download oc binary
  get_url:
    url: "https://github.com/{{ oc_download_url.stdout }}"
    dest: /tmp/oc.tar.gz
    mode: 0777
- name: unzip oc binary
  unarchive: 
    src: /tmp/oc.tar.gz
    dest: /tmp
    extra_opts: [--strip-components=1]
  become: yes
- name: move oc file
  command: mv /tmp/oc /usr/local/bin/oc
  become: yes
- name: set perms on oc
  command: chmod 777 /usr/local/bin/oc
  become: yes